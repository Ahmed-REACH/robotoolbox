---
output:
  github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  warning = FALSE,
  message = FALSE,
  eval = FALSE,
  fig.width = 10,
  fig.path = "inst/img/",
  comment = "#> "
)
```

# robotoolbox <img src="https://gitlab.com/dickoa/robotoolbox/-/raw/master/inst/img/hex_robotoolbox.png" align="right" height="139" />


[![Project Status: Active - Initial development is in progress, but there has not yet been a stable, usable release suitable for the public.](http://www.repostatus.org/badges/latest/wip.svg)](http://www.repostatus.org/#wip)
[![GitLab CI Build Status](https://gitlab.com/dickoa/robotoolbox/badges/master/pipeline.svg)](https://gitlab.com/dickoa/robotoolbox/pipelines)
[![Codecov Code Coverage](https://codecov.io/gl/dickoa/robotoolbox/branch/master/graph/badge.svg)](https://codecov.io/gh/dickoa/robotoolbox)
[![CRAN status](https://www.r-pkg.org/badges/version/robotoolbox)](https://cran.r-project.org/package=robotoolbox)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

`robotoolbox` is an R client for the [KoBoToolbox API](https://www.kobotoolbox.org/).

## Introduction


### KoBoToolBox API concepts


## Installation

This package is not on yet on CRAN and to install it, you will need the [`remotes`](https://github.com/r-lib/remotes) package.
You can get `robotoolbox` from Gitlab or Github (mirror)

```{r}
## install.packages("remotes")
remotes::install_gitlab("dickoa/robotoolbox")
```

## robotoolbox: A quick tutorial

The `robotoolbox` package requires you to set your API token and specify the server URL. The easiest way to do that is to store them in your `.Renviron` file which is automatically read by `R` on startup.

You can retrieve your `API token` following the instruction in the official documentation: https://support.kobotoolbox.org/api.html.

You can also get your token directly from `R` using the `kobo_token` function.


```{r}
kobo_token(username = "xxxxxxxxx",
           password = "xxxxxxxxx",
           url = "https://kobo.unhcr.org")
```

You can either edit directly the `.Renviron` file or access it by calling `usethis::edit_r_environ()` (assuming you have the `usethis` package installed) and entering:

```{bash, eval=FALSE, engine="sh"}
KOBOTOOLBOX_URL="https://kobo.unhcr.org/"
KOBOTOOLBOX_TOKEN=xxxxxxxxxxxxxxxxxxxxxxxxxx
```

Or use directly the `kobo_setup` function

```{r}
kobo_setup(url = "https://kobo.unhcr.org",
           token = "xxxxxxxxxxxxxxxxxxxxxxxxxx")
```


```{r}
library("robotoolbox")
kobo_settings()
## <robotoolbox settings>
##    KoBoToolbox URL: https://kobo.unhcr.org/
##    KoBoToolbox API Token: xxxxxxxxxxxxxxxxxxxxxxxxxx
```

With the settings done, it is possible to list all `assets` (e.g form, project, etc).

```{r}
library("dplyr")
l <- kobo_asset_list()
l
# A tibble: 24 x 8
   uid     name     asset_type owner_username date_created
   <chr>   <chr>    <chr>      <chr>          <dttm>
 1 b9kgvd… Proj_A1… survey     xxxxxxxxxxxxx… 2020-04-27 20:34:23
 2 aRFJMp… Proj_A2… survey     xxxxxxxxxxxxx… 2020-04-27 21:21:12
 3 a6qMG7… Proj_A3… survey     xxxxxxxxxxxxx… 2021-05-25 16:59:08
 4 azhrVs… Proj_A4… survey     xxxxxxxxxxxxx… 2021-05-25 13:59:46
 5 aReR58… Proj_A5… survey     xxxxxxxxxxxxx… 2021-06-07 09:15:53
 6 aWaoqy… Proj_A6… survey     xxxxxxxxxxxxx… 2021-05-29 10:46:09
 7 aABU3C… Proj_A7… survey     xxxxxxxxxxxxx… 2020-11-28 15:00:10
 8 aaznyX… Proj_A9… survey     xxxxxxxxxxxxx… 2020-11-28 14:28:48
 9 aCVr2Q… Proj_A9… survey     xxxxxxxxxxxxx… 2021-05-25 13:30:24
10 aPxNao… Proj_A10… survey    xxxxxxxxxxxxx… 2020-04-27 11:37:34
# … with 14 more rows, and 3 more variables:
#   date_modified <dttm>, submissions <int>, asset <list>
glimpse(l)
$ uid            <chr> "b9kgvd7AXQCmo5qyUOBEl", "aRfJMpTSGRLzZ…"
$ name           <chr> "Proj_A1", "Proj_A2", "Proj_A3", "Proj_A…"
$ asset_type     <chr> "survey", "survey", "survey", "survey", …
$ owner_username <chr> "xxxxxxxxxxxxxx", "xxxxxxxxxxxxxxx", "xx…"
$ date_created   <dttm> 2020-04-27 20:34:23, 2020-04-27 21:21:1…
$ date_modified  <dttm> 2021-06-17 01:52:57, 2021-06-17 01:52:5…
$ submissions    <int> 2951, 2679, 2, 1, 0, 0, 287, 73, 0, 274,…
$ asset          <list> [https://kobo.unhcr.org/api/v2/assets/a…
```

We can select one `asset` to read its submissions it contains

```{r}
asset <- l |>
  filter(name == "proj_A1") |>
  pull(asset) |>
  first()
asset
## <robotoolbox asset>  b9kgvd7AXQCmo5qyUOBEl
##    Asset Name: Proj_A1
##    Asset Type: survey
##    Created: 2020-04-27 20:34:23
##    Last modified: 2021-06-17 01:52:57
##    Submissions: 2951
```

Now with the `asset`, we can extract `submissions`

```{r}
df <- kobo_submissions(asset)
glimpse(df)
## Rows: 2,951
## Columns: 137
## $ start                                                                       <dttm> …
## $ end                                                                         <dttm> …
## $ today                                                                       <date> …
## $ deviceid                                                                    <chr> …
## $ phonenumber                                                                 <chr> …
## $ group_education_school_incident                                             <chr> …
## $ group_education_school_online_access                                        <chr> …
## $ group_legal_protection_documentation_certificate_birth                      <chr> …
## $ group_community_engagement_complaint_mechanism                              <chr> …
## $ group_education_school_alternative_bywhom                                   <chr> …
## $ group_community_engagement_info                                             <chr> …
## $ group_solutions_sense_integrated                                            <chr> …
## $ group_legal_protection_documentation_born_in_displacement                   <chr> …
## $ group_general_protection_sub_group_safety_wellbeing_displacement            <chr> …
## $ group_education_school_online_material                                      <chr> …
## $ group_information_sub_group_interviewer_consent                             <lgl> …
## $ group_information_effective_date                                            <date> …
## $ group_spn_sp_need_what_to_do                                                <chr> …
## $ group_legal_protection_documentation_born_pre_displacement                  <chr> …
## $ group_general_protection_sub_group_safety_wellbeing_freedom_report          <chr> …
## $ group_education_number_six_twelve                                           <dbl> …
## $ group_information_country                                                   <chr> …
## $ group_education_number_child_school_primary                                 <dbl> …
## $ group_wash_wash_access                                                      <chr> …
## $ group_health_health_access                                                  <chr> …
## $ group_legal_protection_acces_asile_foreign                                  <chr> …
## $ group_education_school_online                                               <chr> …
## $ group_legal_protection_documentation_online                                 <chr> …
## $ group_gbv_insecurity_location                                               <chr> …
## $ group_community_engagement_info_app                                         <chr> …
## $ group_general_protection_sub_group_safety_wellbeing_why_no_freedom_movement <chr> …
## $ group_general_protection_sub_group_safety_wellbeing_sense_safety            <chr> …
## $ group_information_is_test                                                   <chr> …
## $ group_shelter_shelter_type                                                  <chr> …
## $ group_legal_protection_documentation_doc_type                               <chr> …
## $ group_information_sub_group_interviewer_location                            <chr> …
## $ group_community_engagement_info_how                                         <chr> …
## $ group_nfi_nfi_need                                                          <chr> …
## $ group_information_sub_group_interviewer_admin_level_2                       <chr> …
## $ group_information_group_interviewee_interviewee_enfant                      <chr> …
## $ group_information_sub_group_interviewer_admin_level_1                       <chr> …
## $ group_education_number_child_school_secondary                               <dbl> …
## $ group_education_number_child_school_coran                                   <dbl> …
## $ group_legal_protection_documentation_marriage_doc                           <chr> …
## $ group_general_protection_sub_group_safety_wellbeing_report_who              <chr> …
## $ group_community_engagement_info_type                                        <chr> …
## $ group_information_sub_group_interviewer_respondent_is_major                 <lgl> …
## $ group_information_group_interviewee_interviewee_sex                         <chr> …
## $ group_general_protection_sub_group_safety_wellbeing_safety                  <chr> …
## $ group_community_engagement_complaint_mechanism_how                          <chr> …
## $ group_education_school_online_material_what                                 <chr> …
## $ group_spn_sp_need_category                                                  <chr> …
## $ group_education_school_alternative_type                                     <chr> …
## $ group_child_protection_protection_child                                     <chr> …
## $ group_education_number_thirteen_eighteen                                    <dbl> …
## $ group_general_protection_sub_group_safety_wellbeing_displacement_type       <chr> …
## $ group_shelter_shelter_cohab                                                 <chr> …
## $ group_information_interviewer_id                                            <chr> …
## $ group_legal_protection_documentation_doc_indiv                              <chr> …
## $ group_education_school_alternative                                          <chr> …
## $ group_gbv_insecurity                                                        <chr> …
## $ group_legal_protection_acces_asile_border_cross                             <chr> …
## $ group_child_protection_protection_separated_child                           <chr> …
## $ group_information_sub_group_interviewer_admin_level_3                       <chr> …
## $ group_spn_sp_need                                                           <chr> …
## $ group_solutions_sense_integrated_whynot                                     <chr> …
## $ group_general_protection_sub_group_safety_wellbeing_freedom_movement        <chr> …
## $ group_education_child_school                                                <chr> …
## $ group_spn_sp_need_sex                                                       <chr> …
## $ group_legal_protection_documentation_marriage_doc_whyno                     <chr> …
## $ group_education_child_school_whynot                                         <chr> …
## $ group_legal_protection_documentation_online_access                          <chr> …
## $ group_legal_protection_documentation_spouse                                 <chr> …
## $ group_gbv_female_help                                                       <chr> …
## $ group_nfi_hygiene_feminin                                                   <chr> …
## $ group_gbv_female_help_who                                                   <chr> …
## $ group_gbv_female_covid                                                      <chr> …
## $ group_gbv_female_gbv                                                        <chr> …
## $ group_legal_protection_documentation_certificate_birth_why                  <chr> …
## $ group_legal_protection_acc_s_asile_foreign                                  <chr> …
## $ group_legal_protection_acc_s_asile_border_cross                             <chr> …
## $ group_child_protection_other_protection_child                               <chr> …
## $ group_gbv_female_gbv_what                                                   <chr> …
## $ group_education_school_protection                                           <chr> …
## $ group_legal_protection_acc_s_asile_border_cross_why                         <chr> …
## $ group_legal_protection_acc_s_asile_border_cross_stop                        <chr> …
## $ group_legal_protection_documentation_other_marriage_doc_whyno               <chr> …
## $ group_legal_protection_acces_asile_border_cross_why                         <chr> …
## $ group_legal_protection_acces_asile_border_cross_stop                        <chr> …
## $ group_solutions_return_satisfied                                            <chr> …
## $ group_solutions_return_why                                                  <chr> …
## $ group_solutions_return_recovery                                             <chr> …
## $ group_general_protection_sub_group_safety_wellbeing_other_freedom_movement  <chr> …
## $ group_general_protection_sub_group_safety_wellbeing_other_safety            <chr> …
## $ group_gbv_female_covid_what                                                 <chr> …
## $ group_education_other_child_school_whynot                                   <chr> …
## $ group_education_other_school_protection                                     <chr> …
## $ group_legal_protection_documentation_easy_idnational                        <chr> …
## $ group_solutions_other_return_why                                            <chr> …
## $ group_legal_protection_documentation_why_no_idnational                      <chr> …
## $ group_shelter_shelter_redisp                                                <chr> …
## $ group_legal_protection_documentation_other_why_no_idnational                <chr> …
## $ group_legal_protection_documentation_why_cannot_id                          <chr> …
## $ group_legal_protection_documentation_other_certificate_birth_why            <chr> …
## $ group_gbv_other_female_gbv_what                                             <chr> …
## $ group_information_begin_group_rq1akkcb5_interviewee_sex                     <chr> …
## $ group_information_begin_group_rq1akkcb5_interviewee_enfant                  <chr> …
## $ group_legal_protection_acc_s_asile_asylum_process                           <chr> …
## $ group_education_other_school_alternative_type                               <chr> …
## $ group_information_begin_group_nyd5zafhk_interviewee_enfant                  <chr> …
## $ group_information_begin_group_nyd5zafhk_interviewee_sex                     <chr> …
## $ group_spn_other_sp_need_category                                            <chr> …
## $ group_community_engagement_other_info_how                                   <chr> …
## $ group_legal_protection_documentation_other_why_cannot_id                    <chr> …
## $ group_legal_protection_acces_asile_asylum_process                           <chr> …
## $ group_solutions_return_recovery_what                                        <chr> …
## $ group_community_engagement_other_complaint_mechanism_how                    <chr> …
## $ group_solutions_return_satisfied_whynot                                     <chr> …
## $ group_general_protection_sub_group_safety_wellbeing_other_report_who        <chr> …
## $ group_legal_protection_acces_asile_other_border_cross_why                   <chr> …
## $ group_solutions_other_return_recovery_what                                  <chr> …
## $ group_legal_protection_acc_s_asile_other_border_cross_why                   <chr> …
## $ `_id`                                                                       <int> …
## $ `_notes`                                                                    <list> …
## $ `_xform_id_string`                                                          <chr> …
## $ `_attachments`                                                              <list> …
## $ `_status`                                                                   <chr> …
## $ `_submitted_by`                                                             <chr> …
## $ `_geolocation`                                                              <list> …
## $ `_version_`                                                                 <chr> …
## $ `__version__`                                                               <chr> …
## $ `_tags`                                                                     <list> …
## $ `_validation_status`                                                        <df[,0]> …
## $ `_uuid`                                                                     <chr> …
## $ `_submission_time`                                                          <dttm> …
## $ `_version__001`                                                             <chr> …
```

## Meta

* Please [report any issues or bugs](https://gitlab.com/dickoa/robotoolbox/issues).
* License: MIT
* Please note that this project is released with a [Contributor Code of Conduct](CONDUCT.md). By participating in this project you agree to abide by its terms.
